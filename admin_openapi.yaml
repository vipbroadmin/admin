openapi: 3.0.3
info:
  title: Admin BFF
  version: 1.0.0
  description: |
    API gateway for players, wallets, withdrawals, and reports services.
    Conventions:
      - Array fields are always arrays (empty array when no data).
      - Optional fields may be null when data is unavailable.
servers:
  - url: http://localhost:8080
security:
  - bearerAuth: []
tags:
  - name: Auth
  - name: Players
  - name: Wallets
  - name: Withdrawals
  - name: Reports
  - name: Reference
  - name: Providers
paths:
  /users/api/v1/staffs/login:
    post:
      tags: [Auth]
      summary: Login and get JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: JWT issued
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
      security: []
  /users/api/v1/staffs/logout:
    delete:
      tags: [Auth]
      summary: Logout (stateless)
      responses:
        "200":
          description: Logged out
          content:
            application/json:
              schema:
                type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"
  /users/api/v1/staffs:
    get:
      tags: [Auth]
      summary: List users
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
      responses:
        "200":
          description: Users list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsersListResponse"
              examples:
                empty:
                  summary: Empty list
                  value:
                    items: []
                    total: 0
        "404":
          $ref: "#/components/responses/NotFound"
    post:
      tags: [Auth]
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateStaffUserRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateStaffUserResponse"
        "422":
          $ref: "#/components/responses/ValidationError"
  /users/api/v1/staffs/{id}/ban:
    put:
      tags: [Auth]
      summary: Block user
      parameters:
        - $ref: "#/components/parameters/idInt"
      responses:
        "200":
          description: Blocked
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
  /users/api/v1/staffs/me:
    get:
      tags: [Auth]
      summary: Get current user
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
              examples:
                withEmptyRoles:
                  summary: No roles assigned
                  value:
                    data:
                      username: "admin"
                      roles: []
        "401":
          $ref: "#/components/responses/Unauthorized"
  /players/api/v1:
    get:
      tags: [Players]
      summary: List players
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/country"
        - $ref: "#/components/parameters/currency"
        - $ref: "#/components/parameters/sortBy"
        - $ref: "#/components/parameters/order"
      responses:
        "200":
          description: Players list
          content:
            application/json:
              schema:
                type: object
              examples:
                empty:
                  summary: Empty list
                  value:
                    items: []
                    total: 0
        "400":
          $ref: "#/components/responses/ValidationError"
        "404":
          $ref: "#/components/responses/NotFound"
    post:
      tags: [Players]
      summary: Create player (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePlayerRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "422":
          $ref: "#/components/responses/ValidationError"
  /players/api/v1/{id}:
    get:
      tags: [Players]
      summary: Get player by ID
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Player data
          content:
            application/json:
              schema:
                type: object
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      tags: [Players]
      summary: Update player
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePlayerRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "404":
          $ref: "#/components/responses/NotFound"
  /players/api/v1/info:
    post:
      tags: [Players]
      summary: Get players info by ids
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlayersInfoRequest"
      responses:
        "200":
          description: Players info
          content:
            application/json:
              schema:
                type: object
              examples:
                empty:
                  summary: No players found
                  value:
                    data: []
  /players/api/v1/{id}/documents:
    get:
      tags: [Players]
      summary: Get player documents
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Documents list
          content:
            application/json:
              schema:
                type: object
              examples:
                empty:
                  summary: No documents
                  value:
                    documents: []
  /players/api/v1/document/{id}:
    patch:
      tags: [Players]
      summary: Update document status
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DocumentStatusRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /players/api/v1/{id}/level:
    put:
      tags: [Players]
      summary: Update player level
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlayerLevelRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /players/api/v1/{id}/password:
    put:
      tags: [Players]
      summary: Update player password
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePasswordRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /players/api/v1/{id}/ban:
    put:
      tags: [Players]
      summary: Ban player
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Banned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /players/api/v1/{id}/unban:
    put:
      tags: [Players]
      summary: Unban player
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Unbanned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /players/api/v1/kick:
    post:
      tags: [Players]
      summary: Kick players
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KickPlayersRequest"
      responses:
        "200":
          description: Kicked
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /players/api/v1/{id}/requisites:
    get:
      tags: [Players]
      summary: Get player requisites
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Requisites
          content:
            application/json:
              schema:
                type: object
              examples:
                notAvailable:
                  summary: Requisites not available
                  value:
                    paymentMethodId: null
                    formData: null
    post:
      tags: [Players]
      summary: Update player requisites
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlayerRequisitesRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
  /finances/api/v1/wallets/by-player-id/{playerId}:
    get:
      tags: [Wallets]
      summary: Get wallets by player ID
      parameters:
        - name: playerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Wallets
          content:
            application/json:
              schema:
                type: object
              examples:
                empty:
                  summary: No wallets
                  value:
                    wallets: []
        "404":
          $ref: "#/components/responses/NotFound"
  /finances/api/v1/wallets:
    post:
      tags: [Wallets]
      summary: Create wallet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWalletRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/wallets/deposit:
    post:
      tags: [Wallets]
      summary: Deposit to wallet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WalletDepositRequest"
      responses:
        "200":
          description: Wallet updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/wallets/cashout:
    post:
      tags: [Wallets]
      summary: Cashout from wallet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WalletCashoutRequest"
      responses:
        "200":
          description: Cashout created
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/wallets/unlock:
    post:
      tags: [Wallets]
      summary: Unlock wallet funds
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WalletUnlockRequest"
      responses:
        "200":
          description: Wallet updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/wallets/confirm-withdrawal:
    post:
      tags: [Wallets]
      summary: Confirm withdrawal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConfirmWithdrawalRequest"
      responses:
        "200":
          description: Wallet updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests:
    post:
      tags: [Withdrawals]
      summary: Create withdrawal request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWithdrawalRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}:
    get:
      tags: [Withdrawals]
      summary: Get withdrawal request
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Withdrawal request
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}/take:
    post:
      tags: [Withdrawals]
      summary: Take withdrawal request
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/managerId"
        - $ref: "#/components/parameters/managerRole"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}/request-verification:
    post:
      tags: [Withdrawals]
      summary: Request verification
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/managerId"
        - $ref: "#/components/parameters/managerRole"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}/approve:
    post:
      tags: [Withdrawals]
      summary: Approve withdrawal
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/managerId"
        - $ref: "#/components/parameters/managerRole"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}/reject:
    post:
      tags: [Withdrawals]
      summary: Reject withdrawal
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/managerId"
        - $ref: "#/components/parameters/managerRole"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RejectWithdrawalRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}/retry:
    post:
      tags: [Withdrawals]
      summary: Retry withdrawal
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/managerId"
        - $ref: "#/components/parameters/managerRole"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/withdrawal-requests/{id}/return:
    post:
      tags: [Withdrawals]
      summary: Return withdrawal
      parameters:
        - $ref: "#/components/parameters/id"
        - $ref: "#/components/parameters/managerId"
        - $ref: "#/components/parameters/managerRole"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
  /finances/api/v1/reports/transactions:
    get:
      tags: [Reports]
      summary: List transactions
      parameters:
        - name: playerId
          in: query
          schema:
            type: string
            format: uuid
        - name: walletId
          in: query
          schema:
            type: string
            format: uuid
        - name: currency
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
        - name: reason
          in: query
          schema:
            type: string
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [created_at, amount, balance_after]
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc, ASC, DESC]
        - name: limit
          in: query
          schema:
            type: integer
        - name: offset
          in: query
          schema:
            type: integer
      responses:
        "200":
          description: Transactions list
          content:
            application/json:
              schema:
                type: object
              examples:
                empty:
                  summary: No transactions
                  value:
                    transactions: []
        "404":
          $ref: "#/components/responses/NotFound"
  /reference/api/v1/countries:
    get:
      tags: [Reference]
      summary: List countries
      responses:
        "200":
          description: Countries list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CountriesResponse"
              examples:
                empty:
                  summary: No countries
                  value:
                    countries: []
  /reference/api/v1/currencies:
    get:
      tags: [Reference]
      summary: List currencies
      responses:
        "200":
          description: Currencies list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CurrenciesResponse"
              examples:
                empty:
                  summary: No currencies
                  value:
                    currencies: []
  /provider/{provider}/api/v1/providers:
    get:
      tags: [Providers]
      summary: List providers
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
      responses:
        "200":
          description: Providers list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SlotegratorProvidersResponse"
              examples:
                empty:
                  summary: No providers
                  value:
                    items: []
        "400":
          $ref: "#/components/responses/ValidationError"
  /provider/{provider}/api/v1/games:
    get:
      tags: [Providers]
      summary: List games
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
        - name: provider_id
          in: query
          schema:
            type: integer
            minimum: 1
        - name: status
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
      responses:
        "200":
          description: Games list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SlotegratorGamesResponse"
              examples:
                empty:
                  summary: No games
                  value:
                    items: []
        "400":
          $ref: "#/components/responses/ValidationError"
  /provider/{provider}/api/v1/launch:
    post:
      tags: [Providers]
      summary: Launch game
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SlotegratorLaunchRequest"
      responses:
        "200":
          description: Launch response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SlotegratorLaunchResponse"
        "400":
          $ref: "#/components/responses/ValidationError"
        "404":
          $ref: "#/components/responses/NotFound"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
  parameters:
    idInt:
      name: id
      in: path
      required: true
      schema:
        type: integer
    id:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    offset:
      name: offset
      in: query
      schema:
        type: integer
    limit:
      name: limit
      in: query
      schema:
        type: integer
    search:
      name: search
      in: query
      schema:
        type: string
    country:
      name: country
      in: query
      schema:
        type: string
    currency:
      name: currency
      in: query
      schema:
        type: string
    sortBy:
      name: sortBy
      in: query
      schema:
        type: string
    order:
      name: order
      in: query
      schema:
        type: string
        enum: [asc, desc]
    managerId:
      name: X-Manager-Id
      in: header
      required: true
      schema:
        type: string
    managerRole:
      name: X-Manager-Role
      in: header
      required: true
      schema:
        type: string
  schemas:
    LoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required: [username, password]
    LoginResponse:
      type: object
      properties:
        token:
          type: string
    UserProfile:
      type: object
      properties:
        data:
          type: object
          properties:
            username:
              type: string
            roles:
              type: array
              items:
                type: string
              minItems: 0
              default: []
    UsersListResponse:
      type: object
      properties:
        items:
          type: array
          minItems: 0
          default: []
          items:
            type: object
            properties:
              id:
                type: integer
              username:
                type: string
              roles:
                type: array
                items:
                  type: string
                minItems: 0
                default: []
              isBlocked:
                type: boolean
        total:
          type: integer
    CreateStaffUserRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        roles:
          type: array
          items:
            type: string
          minItems: 0
          default: []
      required: [username, password]
    CreateStaffUserResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
            roles:
              type: array
              items:
                type: string
              minItems: 0
              default: []
            isBlocked:
              type: boolean
    CountriesResponse:
      type: object
      properties:
        countries:
          type: array
          minItems: 0
          default: []
          items:
            type: object
            properties:
              code:
                type: string
              name_en:
                type: string
    CurrenciesResponse:
      type: object
      properties:
        currencies:
          type: array
          minItems: 0
          default: []
          items:
            type: object
            properties:
              code:
                type: string
              name_en:
                type: string
              symbol:
                type: string
    SlotegratorProvidersResponse:
      type: object
      properties:
        items:
          type: array
          minItems: 0
          default: []
          items:
            type: object
            additionalProperties: true
    SlotegratorGamesResponse:
      type: object
      properties:
        items:
          type: array
          minItems: 0
          default: []
          items:
            type: object
            additionalProperties: true
    SlotegratorLaunchRequest:
      type: object
      properties:
        game_uuid:
          type: string
        player_id:
          type: string
        player_name:
          type: string
        currency:
          type: string
        session_id:
          type: string
        device:
          type: string
          enum: [desktop, mobile]
        return_url:
          type: string
        language:
          type: string
        email:
          type: string
        lobby_data:
          type: string
        demo:
          type: boolean
      required: [game_uuid, player_id, player_name, currency]
    SlotegratorLaunchResponse:
      type: object
      properties:
        session_id:
          type: string
        url:
          type: string
    CreatePlayerRequest:
      type: object
      properties:
        login:
          type: string
        password:
          type: string
        country:
          type: string
        currency:
          type: string
        promoCode:
          type: string
          nullable: true
      required: [login, password, country, currency]
    UpdatePlayerRequest:
      type: object
      properties:
        login:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        surname:
          type: string
          nullable: true
        nickname:
          type: string
          nullable: true
        currency:
          type: string
          nullable: true
        country:
          type: string
          nullable: true
    UpdatePasswordRequest:
      type: object
      properties:
        password:
          type: string
      required: [password]
    PlayerLevelRequest:
      type: object
      properties:
        level:
          type: integer
      required: [level]
    PlayersInfoRequest:
      type: object
      properties:
        ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 0
          default: []
      required: [ids]
    DocumentStatusRequest:
      type: object
      properties:
        status:
          type: string
      required: [status]
    PlayerRequisitesRequest:
      type: object
      properties:
        paymentMethodId:
          type: string
          nullable: true
        formData:
          type: object
          nullable: true
    KickPlayersRequest:
      type: array
      minItems: 0
      default: []
      items:
        type: string
        format: uuid
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
    CreateWalletRequest:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        currency:
          type: string
        type:
          type: string
          nullable: true
      required: [playerId, currency]
    WalletDepositRequest:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        walletId:
          type: string
          format: uuid
        amount:
          type: string
      required: [playerId, walletId, amount]
    WalletCashoutRequest:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        walletId:
          type: string
          format: uuid
        amount:
          type: string
        paymentSystemId:
          type: string
      required: [playerId, walletId, amount, paymentSystemId]
    WalletUnlockRequest:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        walletId:
          type: string
          format: uuid
        amount:
          type: string
      required: [playerId, walletId, amount]
    ConfirmWithdrawalRequest:
      type: object
      properties:
        withdrawalRequestId:
          type: string
          format: uuid
      required: [withdrawalRequestId]
    CreateWithdrawalRequest:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        walletId:
          type: string
          format: uuid
        currency:
          type: string
        amount:
          type: string
        paymentSystemId:
          type: string
      required: [playerId, walletId, currency, amount, paymentSystemId]
    RejectWithdrawalRequest:
      type: object
      properties:
        reason:
          type: string
      required: [reason]
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
